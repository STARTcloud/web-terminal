#!/bin/bash
set -e

case "$1" in
    remove)
        # Keep user, data, and config for potential reinstall
        echo "Web-Terminal removed but user and data preserved"
        ;;
    purge)
        # Remove everything including user and data
        echo "Purging Web-Terminal completely..."
        
        # Remove system user
        if getent passwd wtuser > /dev/null 2>&1; then
            deluser wtuser || true
        fi
        
        # Remove data directories (user confirmation should happen via apt/dpkg)
        rm -rf /var/lib/web-terminal
        rm -rf /var/log/web-terminal
        rm -rf /etc/web-terminal
        
        echo "Web-Terminal completely removed"
        ;;
    upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
        # Do nothing for these cases
        ;;
    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

# Reload systemd daemon (only if systemd is available)
if [ -d /run/systemd/system ]; then
    systemctl daemon-reload || true
fi

#DEBHELPER#
